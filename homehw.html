<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Split Bill Among Friends</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for better aesthetics and font */
        body {
            font-family: "Inter", sans-serif;
        }
        /* Hide number input arrows */
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-500 to-indigo-600 p-4 sm:p-6 text-gray-100 flex items-center justify-center">
    <div class="bg-white bg-opacity-10 backdrop-filter backdrop-blur-lg rounded-xl shadow-2xl p-6 sm:p-8 w-full max-w-3xl border border-white border-opacity-20">
        <h1 class="text-3xl sm:text-4xl font-extrabold text-center mb-8 text-white drop-shadow-lg">
            Split Bill Among Friends
        </h1>

        <!-- Main Section: User Details -->
        <div class="mb-8 p-6 bg-purple-800 bg-opacity-30 rounded-lg shadow-inner border border-purple-600">
            <h2 class="text-2xl font-semibold mb-4 text-white">Your Details</h2>
            <form id="userDetailsForm">
                <div class="mb-4">
                    <label for="userName" class="block text-lg font-semibold mb-2">
                        Name:
                    </label>
                    <input
                        type="text"
                        id="userName"
                        placeholder="Your Name"
                        class="w-full p-3 rounded-lg bg-white bg-opacity-20 border border-white border-opacity-30 focus:outline-none focus:ring-2 focus:ring-purple-300 text-white placeholder-gray-200"
                    />
                </div>
                <div class="mb-4">
                    <label for="userEmail" class="block text-lg font-semibold mb-2">
                        Email:
                    </label>
                    <input
                        type="email"
                        id="userEmail"
                        placeholder="your.email@example.com"
                        class="w-full p-3 rounded-lg bg-white bg-opacity-20 border border-white border-opacity-30 focus:outline-none focus:ring-2 focus:ring-purple-300 text-white placeholder-gray-200"
                    />
                </div>
                <button
                    type="submit"
                    class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg transition-all duration-300 transform hover:scale-105 shadow-lg"
                >
                    Submit Details
                </button>
                <p id="submissionMessage" class="mt-4 text-center text-sm font-medium text-green-300 hidden"></p>
            </form>
        </div>

        <div id="errorMessage" class="bg-red-500 text-white p-3 rounded-lg mb-4 text-center hidden"></div>

        <!-- Total Bill Input -->
        <div class="mb-6">
            <label for="totalBill" class="block text-lg font-semibold mb-2">
                Total Bill Amount:
            </label>
            <input
                type="number"
                id="totalBill"
                placeholder="e.g., 100.00"
                class="w-full p-3 rounded-lg bg-white bg-opacity-20 border border-white border-opacity-30 focus:outline-none focus:ring-2 focus:ring-purple-300 text-white placeholder-gray-200"
            />
        </div>

        <!-- Friends Section -->
        <div class="mb-6">
            <h2 class="text-2xl font-semibold mb-4 text-white">Friends</h2>
            <div id="friendsList" class="flex flex-wrap gap-2 mb-4">
                <!-- Friends will be dynamically added here -->
            </div>
            <button
                id="addFriendBtn"
                class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-lg transition-all duration-300 transform hover:scale-105 shadow-lg"
            >
                Add Friend
            </button>
        </div>

        <!-- Items Section -->
        <div class="mb-6">
            <h2 class="text-2xl font-semibold mb-4 text-white">Items</h2>
            <div id="itemsList" class="space-y-4 mb-4">
                <!-- Items will be dynamically added here -->
            </div>
            <button
                id="addItemBtn"
                class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-lg transition-all duration-300 transform hover:scale-105 shadow-lg"
            >
                Add Item
            </button>
        </div>

        <!-- Results Section -->
        <div>
            <h2 class="text-2xl font-semibold mb-4 text-white">Results</h2>
            <ul id="resultsList" class="space-y-3">
                <!-- Results will be dynamically added here -->
            </ul>
            <p id="noResultsMessage" class="text-center text-gray-300">Enter bill details to see results.</p>
        </div>
    </div>

    <script>
        // Global state variables
        let totalBill = '';
        let friends = [];
        let items = [];
        let nextFriendId = 1;
        let nextItemId = 1;
        let results = {};
        let errorMessage = '';
        let userName = '';
        let userEmail = '';
        let submissionMessage = '';

        // DOM Elements
        const totalBillInput = document.getElementById('totalBill');
        const friendsListDiv = document.getElementById('friendsList');
        const addFriendBtn = document.getElementById('addFriendBtn');
        const itemsListDiv = document.getElementById('itemsList');
        const addItemBtn = document.getElementById('addItemBtn');
        const resultsListUl = document.getElementById('resultsList');
        const noResultsMessage = document.getElementById('noResultsMessage');
        const errorMessageDiv = document.getElementById('errorMessage');
        const userDetailsForm = document.getElementById('userDetailsForm');
        const userNameInput = document.getElementById('userName');
        const userEmailInput = document.getElementById('userEmail');
        const submissionMessageP = document.getElementById('submissionMessage');

        // Function to update the error message display
        const updateErrorMessage = () => {
            if (errorMessage) {
                errorMessageDiv.textContent = errorMessage;
                errorMessageDiv.classList.remove('hidden');
            } else {
                errorMessageDiv.classList.add('hidden');
            }
        };

        // Function to update the submission message display
        const updateSubmissionMessage = () => {
            if (submissionMessage) {
                submissionMessageP.textContent = submissionMessage;
                submissionMessageP.classList.remove('hidden');
                // Hide after 5 seconds
                setTimeout(() => {
                    submissionMessageP.classList.add('hidden');
                    submissionMessage = ''; // Clear message after hiding
                }, 5000);
            } else {
                submissionMessageP.classList.add('hidden');
            }
        };

        // Function to render friends list
        const renderFriends = () => {
            friendsListDiv.innerHTML = ''; // Clear current list
            friends.forEach(friend => {
                const friendDiv = document.createElement('div');
                friendDiv.className = 'flex items-center bg-purple-700 bg-opacity-50 rounded-full px-4 py-2 text-sm font-medium shadow-md';
                friendDiv.innerHTML = `
                    <span>${friend.name}</span>
                    <button
                        class="ml-2 text-red-300 hover:text-red-100 transition-colors duration-200"
                        aria-label="Remove ${friend.name}"
                        data-friend-id="${friend.id}"
                    >
                        &times;
                    </button>
                `;
                friendsListDiv.appendChild(friendDiv);

                // Add event listener to the remove button
                friendDiv.querySelector('button').addEventListener('click', (e) => {
                    removeFriend(parseInt(e.target.dataset.friendId));
                });
            });
        };

        // Function to render items list
        const renderItems = () => {
            itemsListDiv.innerHTML = ''; // Clear current list
            items.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'bg-purple-700 bg-opacity-30 p-4 rounded-lg shadow-md border border-purple-500';
                itemDiv.innerHTML = `
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-2">
                        <h3 class="text-xl font-medium mb-2 sm:mb-0">${item.description} - $${item.amount.toFixed(2)}</h3>
                        <button
                            class="text-red-300 hover:text-red-100 transition-colors duration-200 text-2xl"
                            aria-label="Remove ${item.description}"
                            data-item-id="${item.id}"
                        >
                            &times;
                        </button>
                    </div>
                    <div class="text-sm font-light mb-2">Who shared this item?</div>
                    <div class="flex flex-wrap gap-2" id="itemParticipants-${item.id}">
                        <!-- Participants will be dynamically added here -->
                    </div>
                `;
                itemsListDiv.appendChild(itemDiv);

                // Add event listener to the remove item button
                itemDiv.querySelector('button[data-item-id]').addEventListener('click', (e) => {
                    removeItem(parseInt(e.target.dataset.itemId));
                });

                // Render participants for this item
                const participantsDiv = itemDiv.querySelector(`#itemParticipants-${item.id}`);
                friends.forEach(friend => {
                    const participantButton = document.createElement('button');
                    participantButton.className = `px-3 py-1 rounded-full text-xs font-semibold transition-all duration-200 ${
                        item.participants.includes(friend.id)
                            ? 'bg-green-500 text-white shadow-inner'
                            : 'bg-white bg-opacity-20 text-gray-100 hover:bg-opacity-30'
                    }`;
                    participantButton.textContent = friend.name;
                    participantButton.dataset.itemId = item.id;
                    participantButton.dataset.friendId = friend.id;
                    participantsDiv.appendChild(participantButton);

                    // Add event listener to toggle participant
                    participantButton.addEventListener('click', (e) => {
                        toggleParticipant(parseInt(e.target.dataset.itemId), parseInt(e.target.dataset.friendId));
                    });
                });
            });
        };

        // Function to render results
        const renderResults = () => {
            resultsListUl.innerHTML = ''; // Clear current results
            if (Object.keys(results).length > 0 && Object.values(results).some(r => r.owes > 0)) {
                noResultsMessage.classList.add('hidden');
                Object.values(results).forEach(result => {
                    const resultLi = document.createElement('li');
                    resultLi.className = 'flex justify-between items-center bg-white bg-opacity-20 p-4 rounded-lg shadow-md border border-white border-opacity-30';
                    resultLi.innerHTML = `
                        <span class="text-lg font-medium">${result.name}</span>
                        <span class="text-xl font-bold text-green-300">$${result.owes.toFixed(2)}</span>
                    `;
                    resultsListUl.appendChild(resultLi);
                });
            } else {
                noResultsMessage.classList.remove('hidden');
            }
        };

        // Main render function to update all sections
        const renderApp = () => {
            updateErrorMessage();
            updateSubmissionMessage();
            renderFriends();
            renderItems();
            renderResults();
        };

        // Event Listeners
        totalBillInput.addEventListener('input', (e) => {
            const value = e.target.value;
            if (/^\d*\.?\d*$/.test(value) || value === '') {
                totalBill = value;
                errorMessage = '';
            } else {
                errorMessage = 'Please enter a valid number for the total bill.';
            }
            calculateBill(); // Recalculate on total bill change
            renderApp();
        });

        addFriendBtn.addEventListener('click', () => {
            const friendName = prompt('Enter friend\'s name:');
            if (friendName && friendName.trim() !== '') {
                friends.push({ id: nextFriendId, name: friendName.trim() });
                nextFriendId++;
                errorMessage = '';
            } else if (friendName !== null) {
                errorMessage = 'Friend name cannot be empty.';
            }
            calculateBill(); // Recalculate as friends affect splitting
            renderApp();
        });

        addItemBtn.addEventListener('click', () => {
            if (friends.length === 0) {
                errorMessage = 'Please add at least one friend before adding items.';
                renderApp();
                return;
            }

            const description = prompt('Enter item description:');
            if (!description || description.trim() === '') {
                if (description !== null) errorMessage = 'Item description cannot be empty.';
                renderApp();
                return;
            }

            const amountStr = prompt('Enter item amount:');
            if (!amountStr || amountStr.trim() === '') {
                if (amountStr !== null) errorMessage = 'Item amount cannot be empty.';
                renderApp();
                return;
            }

            const amount = parseFloat(amountStr);
            if (isNaN(amount) || amount <= 0) {
                errorMessage = 'Please enter a valid positive number for the item amount.';
                renderApp();
                return;
            }

            items.push({ id: nextItemId, description: description.trim(), amount: amount, participants: [] });
            nextItemId++;
            errorMessage = '';
            calculateBill(); // Recalculate as items affect splitting
            renderApp();
        });

        // Function to remove a friend
        const removeFriend = (id) => {
            friends = friends.filter(friend => friend.id !== id);
            // Also remove the friend from any items they were participating in
            items = items.map(item => ({
                ...item,
                participants: item.participants.filter(participantId => participantId !== id)
            }));
            errorMessage = '';
            calculateBill();
            renderApp();
        };

        // Function to remove an item
        const removeItem = (id) => {
            items = items.filter(item => item.id !== id);
            errorMessage = '';
            calculateBill();
            renderApp();
        };

        // Function to toggle a participant for a specific item
        const toggleParticipant = (itemId, friendId) => {
            items = items.map(item => {
                if (item.id === itemId) {
                    const newParticipants = item.participants.includes(friendId)
                        ? item.participants.filter(id => id !== friendId)
                        : [...item.participants, friendId];
                    return { ...item, participants: newParticipants };
                }
                return item;
            });
            errorMessage = '';
            calculateBill();
            renderApp();
        };

        // Main function to calculate the bill
        const calculateBill = () => {
            let billAmount = parseFloat(totalBill);
            if (isNaN(billAmount) || billAmount <= 0) {
                results = {};
                return;
            }

            // Initialize results for each friend
            const newResults = {};
            friends.forEach(friend => {
                newResults[friend.id] = { name: friend.name, owes: 0, paid: 0 };
            });

            let totalItemsCost = 0;

            // Calculate cost per participant for each item
            items.forEach(item => {
                totalItemsCost += item.amount;
                if (item.participants.length > 0) {
                    const costPerParticipant = item.amount / item.participants.length;
                    item.participants.forEach(participantId => {
                        if (newResults[participantId]) {
                            newResults[participantId].owes += costPerParticipant;
                        }
                    });
                }
            });

            // Adjust amounts based on the total bill if itemized sum doesn't match
            if (totalItemsCost > 0 && Math.abs(totalItemsCost - billAmount) > 0.01) {
                const adjustmentFactor = billAmount / totalItemsCost;
                Object.keys(newResults).forEach(friendId => {
                    newResults[friendId].owes *= adjustmentFactor;
                });
            } else if (totalItemsCost === 0 && friends.length > 0) {
                // If no items, split total bill evenly among all friends
                const costPerFriend = billAmount / friends.length;
                friends.forEach(friend => {
                    newResults[friend.id].owes = costPerFriend;
                });
            }

            results = newResults;
        };

        // User Details Form Submission
        userDetailsForm.addEventListener('submit', (e) => {
            e.preventDefault();
            userName = userNameInput.value;
            userEmail = userEmailInput.value;

            if (userName.trim() === '' || userEmail.trim() === '') {
                submissionMessage = 'Please fill in both name and email.';
                submissionMessageP.style.color = 'red'; // Set color for error
                renderApp();
                return;
            }
            if (!/\S+@\S+\.\S+/.test(userEmail)) {
                submissionMessage = 'Please enter a valid email address.';
                submissionMessageP.style.color = 'red'; // Set color for error
                renderApp();
                return;
            }

            console.log('User Details Submitted:', { name: userName, email: userEmail });
            submissionMessage = `Thank you, ${userName}! Your details have been submitted.`;
            submissionMessageP.style.color = '#86efac'; // Set color for success (green-300 equivalent)
            renderApp();
            // Optionally clear the fields after submission
            // userNameInput.value = '';
            // userEmailInput.value = '';
        });

        // Initial render when the page loads
        window.onload = renderApp;

    </script>
</body>
</html>
